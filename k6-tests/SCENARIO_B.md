# 시나리오 B: 캐시 성능 테스트

## 개요

Redis 기반 캐시 시스템의 성능을 검증하는 테스트입니다. URL 단축 서비스의 리다이렉션 API를 대상으로 부하 테스트를 수행합니다.

### 테스트 스크립트

- **파일**: `scenario-b-fast.js`
- **API**: `GET /{shortUrl}` (리다이렉션)
- **설정**: 1,000 VU, 5분간 테스트

### 🎯 실제 테스트 결과

| 지표             | 목표    | 실제 결과    | 상태    |
| ---------------- | ------- | ------------ | ------- |
| **에러율**       | < 1%    | 0.00%        | ✅ 달성 |
| **TPS**          | > 1,000 | 10,597 req/s | ✅ 달성 |
| **P95 응답시간** | < 100ms | 148ms        | ⚠️ 초과 |
| **총 요청**      | -       | 3,189,212개  | ✅ 안정 |

## 테스트 시나리오

### 1. URL 생성 (setup)

- 테스트 시작 시 50개의 실제 URL을 동적으로 생성
- 80% 인기 URL, 20% 비인기 URL로 분류

### 2. 부하 테스트

- **부하**: 1,000 VU 고정, 5분간 지속
- **패턴**: 80% 인기키 / 20% 비인기키 요청
- **API**: `GET /{shortCode}` 리다이렉션 요청

## 실행 방법

### 1. 환경 준비

```bash
# 전체 환경 시작
docker-compose up -d
```

### 2. 테스트 실행

```bash
# 권장: JSON 출력으로 실행
k6 run --out json=results.json k6-tests/scenario-b-fast.js

# 또는 InfluxDB 연동 (에러 발생 가능)
k6 run --out influxdb=http://localhost:8086/k6 k6-tests/scenario-b-fast.js
```

## 검증 지표

### 성능 목표

- **에러율**: < 1% (실제: 0.00% ✅)
- **TPS**: > 1,000 req/s (실제: 10,597 req/s ✅)
- **P95 응답시간**: < 100ms (실제: 148ms ⚠️)
- **동시성**: 1,000 VU 안정 처리 (실제: 0.00% 에러율 ✅)

## 문제 해결

### 주요 문제 (해결됨)

#### 1. 높은 에러율 (95.81%) → 0.00%로 해결

**원인**: 하드코딩된 가상 shortCode 사용  
**해결**: 실제 존재하는 URL을 동적으로 생성

#### 2. InfluxDB "Request Entity Too Large" 에러

**원인**: k6에서 InfluxDB로 전송하는 배치 데이터가 너무 큼  
**해결**: JSON 출력 사용 권장

### 일반적인 문제

- **연결 실패**: `docker-compose up -d`로 환경 시작
- **포트 문제**: 8080, 6379 포트 확인
- **k6 설치**: 공식 설치 가이드 참조

## 결과 확인

### 테스트 결과 예시

```
✓ http_req_failed................: 0.00%  ✓ 0            ✗ 3189262
✓ http_reqs......................: 3189262 10596.581098/s
  http_req_duration..............: avg=84.45ms   p(95)=148ms
```

### 모니터링

- **Grafana**: http://localhost:3000 (admin/admin)
- **Prometheus**: http://localhost:9090
