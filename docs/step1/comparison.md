# 종합 비교 분석

## 3단계 비교표

| 항목                | Phase 1<br/>(OFF/OFF) | Phase 2<br/>(OFF/ON) | Phase 3<br/>(ON/ON) | Phase 2 효과  | Phase 3 효과 |
| ------------------- | --------------------- | -------------------- | ------------------- | ------------- | ------------ |
| **응답 시간**       |
| p50 latency         | 366.36 ms             | 297.79 ms            | ? ms                | -18.7% 개선   | ?% 개선      |
| p95 latency         | 11,062.87 ms          | 10,864.83 ms         | ? ms                | -1.8% 개선    | ?% 개선      |
| p99 latency         | >1,000 ms             | >1,000 ms            | ? ms                | -             | ?% 개선      |
| **처리량**          |
| RPS                 | 99.00 req/s           | 99.30 req/s          | ?                   | +0.3% 증가    | ?% 증가      |
| **데이터베이스**    |
| DB QPS              | Last 82.8, Max 128    | Last 93.2, Max 128   | ?                   | +12.6% (Last) | ?% 감소      |
| Active Connections  | 최대 10개             | 최대 1개             | ?                   | -90% 감소     | ?% 변화      |
| Execution Time      | 86.340 ms             | ? ms                 | ? ms                | ?% 개선       | -            |
| **캐시**            |
| 캐시 히트율         | 0%                    | 0%                   | ?%                  | -             | -            |
| Redis CPU           | -                     | -                    | ?%                  | -             | -            |
| **EXPLAIN ANALYZE** |
| Plan                | Seq Scan              | Index Scan           | Index Scan          | ✅            | -            |
| Buffers (hit)       | 1,032                 | ?                    | ?                   | ?% 증가       | -            |
| Buffers (read)      | 0                     | ?                    | ?                   | ?% 감소       | -            |
| Rows Removed        | 99,999                | ?                    | ?                   | ?% 감소       | -            |

---

## 각 전략의 효과 분석

### 인덱스 효과 (Phase 1 → Phase 2)

**주요 개선**:

- **Active Connections: 90% 감소** (10개 → 1개) - 가장 명확한 개선 지표
- DB 쿼리 실행 시간 단축으로 커넥션 효율성 대폭 향상
- p50 latency: 18.7% 개선
- DB QPS Last: 12.6% 증가

**한계**:

- 캐시가 없으면 매 요청마다 DB 접근 필요
- 트래픽이 많으면 DB 부하가 여전히 큼
- 커넥션 풀 고갈 가능성

**결론**:
인덱스는 DB 조회 성능을 개선하며, Active Connections이 90% 감소하는 등 커넥션 효율성이 크게 향상되었습니다. 하지만 p95 latency는 1.8%만 개선되어 다른 병목이 존재함을 시사합니다. 트래픽이 많으면 DB 부하가 여전히 큼. 인덱스만으로는 대규모 트래픽 처리에 한계가 있음.

**정량적 효과**:

- **Active Connections: 10개 → 1개 (-90% 감소)** - 가장 명확한 개선 지표
- p50 latency: 366.36 ms → 297.79 ms (-18.7% 개선)
- p95 latency: 11,062.87 ms → 10,864.83 ms (-1.8% 개선)
- DB QPS Last: 82.8 → 93.2 (+12.6% 증가)
- DB QPS Max: 128 → 128 (동일)

### 캐시 효과 (Phase 2 → Phase 3)

**주요 개선**:

- 응답 시간 (특히 p50): ?% 개선
- DB 부하 감소: ?% 감소
- Hot/Warm 데이터 처리: 대부분 캐시로 처리

**핵심**:
Hot/Warm 데이터의 대부분을 캐시로 처리하여 DB 접근 최소화. 캐시 히트율이 높을수록 DB 부하는 급격히 감소.

**결론**:
캐시는 DB 부하를 크게 줄이고 응답 시간을 단축. 인덱스와 함께 사용하면 최적의 성능을 달성할 수 있음.

**정량적 효과**:

- p95 latency: ? ms → ? ms (?% 개선)
- p50 latency: ? ms → ? ms (?% 개선)
- DB QPS: ? → ? (?% 감소)
- 캐시 히트율: ?%

### 종합 효과 (Phase 1 → Phase 3)

**전체 개선**:

- p95 latency: ? ms → ? ms (?% 개선)
- p50 latency: ? ms → ? ms (?% 개선)
- DB CPU: ?% → ?% (?% 감소)
- DB QPS: ? → ? (?% 감소)

**전략 조합의 효과**:
인덱스와 캐시를 함께 사용하면 각각의 장점을 극대화할 수 있음:

- 인덱스: 캐시 미스 시 DB 조회 성능 최적화
- 캐시: Hot/Warm 데이터 처리로 DB 부하 최소화

---

---

## 결론 및 인사이트

### 핵심 발견사항

1. **인덱스의 효과**

   - DB 쿼리 실행 시간을 크게 단축
   - 하지만 트래픽이 많으면 DB 부하가 여전히 큼
   - 캐시와 함께 사용해야 최적의 성능 달성

2. **캐시의 효과**

   - Hot/Warm 데이터 처리로 DB 부하를 크게 감소
   - 응답 시간을 극적으로 단축 (특히 p50)
   - 캐시 히트율이 높을수록 효과가 큼

3. **전략 조합의 중요성**
   - 인덱스와 캐시를 함께 사용하면 각각의 장점을 극대화
   - 인덱스: 캐시 미스 시 DB 조회 성능 최적화
   - 캐시: Hot/Warm 데이터 처리로 DB 부하 최소화

---

## 참고 자료

- [Phase 1: 베이스라인 측정](./phase1-baseline.md)
- [Phase 2: 인덱스 적용](./phase2-index.md)
- [Phase 3: 캐시 적용](./phase3-cache.md)
- [README: 전체 개요](./README.md)
