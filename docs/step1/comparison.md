# 종합 비교 분석

## 3단계 비교표

| 항목               | Phase 1<br/>(OFF/OFF) | Phase 2<br/>(OFF/ON) | Phase 3<br/>(ON/ON) | Phase 2 효과  | Phase 3 효과 |
| ------------------ | --------------------- | -------------------- | ------------------- | ------------- | ------------ |
| **응답 시간**      |
| p50 latency        | 121 ms                | 104 ms               | 95 ms               | -14.0% 개선   | -8.7% 개선   |
| p95 latency        | 698 ms                | 655 ms               | 639 ms              | -6.2% 개선    | -2.4% 개선   |
| **처리량**         |
| RPS                | 99.00 req/s           | 99.30 req/s          | 100.5 req/s         | +0.3% 증가    | +1.2% 증가   |
| 요청 실패율        | 1.32%                 | 1.34%                | 1.22%               | +0.02% 증가   | -8.9% 개선   |
| **데이터베이스**   |
| DB QPS             | Last 82.8, Max 128    | Last 93.2, Max 128   | Last 14.0, Max 44.7 | +12.6% (Last) | -65.1% (Max) |
| Active Connections | 최대 10개             | 최대 1개             | 최대 1개            | -90% 감소     | 0% 변화      |
| **캐시**           |
| 캐시 히트율        | 0%                    | 0%                   | 81.8%               | -             | -            |

**참고**:

- p50, p95 latency는 서버 응답 시간(`http_req_waiting`) 기준입니다.
- 전체 요청 시간(`http_req_duration`)은 네트워크 지연을 포함하므로, 실제 서버 성능 평가는 위의 서버 응답 시간을 기준으로 합니다.

---

## 각 전략의 효과 분석

### 인덱스 효과 (Phase 1 → Phase 2)

**주요 개선**:

- **Active Connections: 90% 감소** (10개 → 1개) - 가장 명확한 개선 지표
- DB 쿼리 실행 시간 단축으로 커넥션 효율성 대폭 향상
- 서버 응답 시간: p50 14.0% 개선, p95 6.2% 개선
- DB QPS Last: 12.6% 증가

**한계**:

- 캐시가 없으면 매 요청마다 DB 접근 필요
- 트래픽이 많으면 DB 부하가 여전히 큼
- 커넥션 풀 고갈 가능성

**결론**:
인덱스는 DB 조회 성능을 개선하며, Active Connections이 90% 감소하는 등 커넥션 효율성이 크게 향상되었습니다. 서버 응답 시간도 p50 14.0%, p95 6.2% 개선되었으나, 여전히 다른 병목이 존재함을 시사합니다. 트래픽이 많으면 DB 부하가 여전히 큼. 인덱스만으로는 대규모 트래픽 처리에 한계가 있음.

**정량적 효과**:

- **Active Connections: 10개 → 1개 (-90% 감소)** - 가장 명확한 개선 지표
- **서버 응답 시간 (http_req_waiting)**:
  - p50 latency: 121 ms → 104 ms (-14.0% 개선)
  - p95 latency: 698 ms → 655 ms (-6.2% 개선)
- **DB QPS**: Last 82.8 → 93.2 (+12.6% 증가), Max 128 → 128 (동일)
- **Execution Time**: 86.340 ms → 0.028 ms (-99.97% 개선, EXPLAIN ANALYZE 기준)

### 캐시 효과 (Phase 2 → Phase 3)

**주요 개선**:

- **서버 응답 시간**: p50 8.7% 개선, p95 2.4% 개선
- **DB 부하 감소**: DB QPS Max 65.1% 감소 (128 → 44.7)
- **Hot/Warm 데이터 처리**: 캐시 히트율 81.8%로 대부분 캐시로 처리
- **요청 실패율**: 8.9% 개선 (1.34% → 1.22%)

**핵심**:
Hot/Warm 데이터의 대부분을 캐시로 처리하여 DB 접근 최소화. 캐시 히트율이 높을수록 DB 부하는 급격히 감소.

**결론**:
캐시는 DB 부하를 크게 줄이고 응답 시간을 단축. 인덱스와 함께 사용하면 최적의 성능을 달성할 수 있음.

**정량적 효과**:

- **서버 응답 시간 (http_req_waiting)**:
  - p50 latency: 104 ms → 95 ms (-8.7% 개선)
  - p95 latency: 655 ms → 639 ms (-2.4% 개선)
  - 평균: 272 ms → 250 ms (-8.1% 개선)
- **DB QPS**: Max 128 → 44.7 (-65.1% 감소)
- **캐시 히트율**: 0% → 81.8%
- **요청 실패율**: 1.34% → 1.22% (-8.9% 개선)

### 종합 효과 (Phase 1 → Phase 3)

**전체 개선**:

- **서버 응답 시간**:
  - p50 latency: 121 ms → 95 ms (-21.5% 개선)
  - p95 latency: 698 ms → 639 ms (-8.5% 개선)
- **DB 부하**:
  - DB QPS Max: 128 → 44.7 (-65.1% 감소)
  - Active Connections: 10개 → 1개 (-90% 감소)
- **처리량**:
  - RPS: 99.0 → 100.5 (+1.5% 증가)
  - 요청 실패율: 1.32% → 1.22% (-7.6% 개선)

**전략 조합의 효과**:
인덱스와 캐시를 함께 사용하면 각각의 장점을 극대화할 수 있음:

- 인덱스: 캐시 미스 시 DB 조회 성능 최적화
- 캐시: Hot/Warm 데이터 처리로 DB 부하 최소화

---

---

## 결론 및 인사이트

### 핵심 발견사항

1. **인덱스의 효과**

   - DB 쿼리 실행 시간을 크게 단축
   - 하지만 트래픽이 많으면 DB 부하가 여전히 큼
   - 캐시와 함께 사용해야 최적의 성능 달성

2. **캐시의 효과**

   - Hot/Warm 데이터 처리로 DB 부하를 크게 감소
   - 응답 시간을 극적으로 단축 (특히 p50)
   - 캐시 히트율이 높을수록 효과가 큼

3. **전략 조합의 중요성**
   - 인덱스와 캐시를 함께 사용하면 각각의 장점을 극대화
   - 인덱스: 캐시 미스 시 DB 조회 성능 최적화
   - 캐시: Hot/Warm 데이터 처리로 DB 부하 최소화

---

## 참고 자료

- [Phase 1: 베이스라인 측정](./phase1-baseline.md)
- [Phase 2: 인덱스 적용](./phase2-index.md)
- [Phase 3: 캐시 적용](./phase3-cache.md)
- [README: 전체 개요](./README.md)
